(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7aafd9a6"],{"32fb":function(e,t,o){"use strict";o.r(t);var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticStyle:{padding:"30px"}},[e._m(0),e._v(" "),o("EmailHooksTable",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{hooks:e.hooks},on:{upload:e.uploadHandler,enable:e.enableHandler,edit:e.editHandler,preview:e.previewHandler}}),e._v(" "),e.showUploadDialog?o("DialogEmailUploader",{attrs:{"show-dialog":e.showUploadDialog,"current-hook":e.updateHook},on:{"update:showDialog":function(t){e.showUploadDialog=t},"update:show-dialog":function(t){e.showUploadDialog=t}}}):e._e(),e._v(" "),e.showDialog?o("DialogEditEmail",{attrs:{"show-dialog":e.showDialog,"edit-hook-data":e.updateHook},on:{"update:showDialog":function(t){e.showDialog=t},"update:show-dialog":function(t){e.showDialog=t},update:e.updateHookHandler}}):e._e(),e._v(" "),e.showPreviewer?o("DialogEmailPreviewer",{attrs:{"show-dialog":e.showPreviewer,"preview-hook":e.updateHook},on:{"update:showDialog":function(t){e.showPreviewer=t},"update:show-dialog":function(t){e.showPreviewer=t}}}):e._e()],1)},n=[function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticStyle:{with:"100%"}},[o("div",{staticStyle:{display:"flex",position:"relative"}},[o("h2",[e._v("服務信設定")])])])}],a=(o("8e6e"),o("ac6a"),o("456d"),o("96cf"),o("3b8d")),i=o("bd86"),l=o("2f62"),s=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-table",{attrs:{data:e.hooks}},[e._l(e.cols_,(function(t,r){return o("el-table-column",{key:r,attrs:{label:t.label,sortable:t.sortable,"show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(r){return["templatePath"===t.scope?o("a",{attrs:{href:r.row.templatePath||"/#"+e.$route.fullPath},on:{click:function(t){return t.preventDefault(),e.previewHook(r.row)}}},[o("i",{staticClass:"el-icon-download"}),e._v("\n        點我下載\n      ")]):"isEnable"===t.scope?o("div",[o("i",{directives:[{name:"permission",rawName:"v-permission",value:["EDM-查看者"],expression:"['EDM-查看者']"}],class:"1"===r.row["isEnable"]?"el-icon-success":"el-icon-error",staticStyle:{cursor:"pointer"}}),e._v(" "),o("i",{directives:[{name:"permission",rawName:"v-permission",value:["EDM-編輯者"],expression:"['EDM-編輯者']"}],class:"1"===r.row["isEnable"]?"el-icon-success":"el-icon-error",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.enableHook(r.row)}}})]):o("h4",{staticStyle:{color:"gray"}},[e._v("\n        "+e._s(r.row[t.scope])+"\n      ")])]}}],null,!0)})})),e._v(" "),o("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{staticStyle:{padding:"12px12px"},attrs:{type:"primary"},on:{click:function(o){return e.edit(t.row)}}},[e._v("更新")]),e._v(" "),o("el-button",{staticStyle:{padding:"12px12px"},attrs:{type:"primary"},on:{click:function(o){return e.upload(t.row)}}},[e._v("上傳")])]}}])})],2)},c=[],u={name:"EmailHooksTable",props:{hooks:{type:Array,required:!0}},computed:{cols_:function(){return[{label:"類別",scope:"title"},{label:"樣板下載",scope:"templatePath"},{label:"評分返回連結",scope:"redirectURL"},{label:"啟用",scope:"isEnable"}]}},methods:{upload:function(e){this.$emit("upload",e)},enableHook:function(e){this.$emit("enable",e)},edit:function(e){this.$emit("edit",e)},previewHook:function(e){this.$emit("preview",e)}}},p=u,d=(o("7dc7"),o("2877")),h=Object(d["a"])(p,s,c,!1,null,"117a54f6",null),f=h.exports,m=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.title,visible:e.showDialog,direction:"btt","before-close":e.handleClose,width:"800px"}},[o("uploader",{ref:"upload",staticClass:"uploader-example",attrs:{options:e.options},on:{complete:e.completeHandler}},[o("uploader-unsupport"),e._v(" "),o("uploader-drop",[o("p",[e._v("Drop files here to upload or")]),e._v(" "),o("uploader-btn",{attrs:{directory:!0}},[e._v("選擇資料夾")])],1),e._v(" "),o("uploader-list")],1)],1)},b=[];function v(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function g(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?v(Object(o),!0).forEach((function(t){Object(i["a"])(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):v(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var w={name:"DialogEmailUploader",props:{showDialog:{type:Boolean,default:!1},currentHook:{type:Object,required:!0}},data:function(){return{options:{target:"",testChunks:!1,headers:{}}}},computed:g({title:function(){return"更新Email樣板 - ".concat(this.currentHook.title)},url:function(){return"".concat("https://edm.callcarbar.com.tw","/v1/settings/reservations/emails/").concat(this.currentHook.id,"/template")}},Object(l["c"])({token:"token"})),mounted:function(){this.options.target=this.url,this.options.headers.authorization="Bearer ".concat(this.token)},methods:{handleClose:function(){this.$emit("update:showDialog",!1)},completeHandler:function(){this.$message.success({message:"上傳成功",type:"success"}),this.handleClose()}}},k=w,y=Object(d["a"])(k,m,b,!1,null,null,null),E=y.exports,O=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.title,visible:!0,direction:"btt","before-close":e.handleClose,width:"800px"}},[o("el-form",{ref:"ruleForm",staticStyle:{width:"80%","margin-left":"5%"},attrs:{model:e.hookData,"label-position":"left","label-width":"25%",rules:e.hookRules}},[e._l(e.fields,(function(t){return o(t.type,{key:t.name,tag:"component",attrs:{placeholder:t.placeholder,name:t.name,label:t.label,disabled:t.disabled,options:t.options,maxlength:t.maxlength},model:{value:e.hookData[t.name],callback:function(o){e.$set(e.hookData,t.name,o)},expression:"hookData[field.name]"}})})),e._v(" "),o("el-form-item",[o("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("儲存")]),e._v(" "),o("el-button",{on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("重置")])],1)],2)],1)},D=[],_=(o("7f7f"),o("e94b")),H={name:"DialogEditEmail",components:{TextInput:_["a"]},props:{showDialog:{type:Boolean,required:!0},editHookData:{type:Object,default:function(){}}},data:function(){var e=[{type:"TextInput",name:"redirectURL",value:"",label:"評分返回連結",placeholder:""}],t=e.reduce((function(e,t){return e[t.name]=t.value,e}),{}),o=e.reduce((function(e,t){return e[t.name]=t.rules,e}),{});return{fields:e,hookData:t,hookRules:o}},computed:{title:function(){return"編輯Email服務 - ".concat(this.hookData.title)}},mounted:function(){this.hookData=Object.assign({},this.editHookData)},methods:{handleClose:function(){this.$emit("update:showDialog",!1)},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.$emit("update",t.hookData)}))},resetForm:function(e){this.$refs[e].resetFields()}}},x=H,j=Object(d["a"])(x,O,D,!1,null,null,null),P=j.exports,S=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.title,visible:!0,direction:"btt","before-close":e.handleClose,width:"500px",height:"800"}},[o("iframe",{attrs:{src:e.iframeRawContent,frameborder:"0",width:"460",height:"667"}})])},R=[],$=new XMLHttpRequest,C={name:"DialogEmailPreviewer",props:{showDialog:{type:Boolean,required:!0},previewHook:{type:Object,required:!0}},data:function(){return{iframeRawContent:""}},computed:{iframeSrc:function(){var e=this.previewHook.templatePath;return e},title:function(){var e=this.previewHook.title;return"預覽 - ".concat(e)}},mounted:function(){$.addEventListener("load",this.xhrLoadHandler),$.addEventListener("error",this.xhrErrorHandler),this.getIframeContent()},beforeDestroy:function(){$.removeEventListener("load",this.xhrLoadHandler),$.removeEventListener("error",this.xhrErrorHandler)},methods:{handleClose:function(){this.$emit("update:showDialog",!1)},getIframeContent:function(){this.iframeSrc?($.open("GET",this.iframeSrc),$.send()):this.xhrErrorHandler()},xhrLoadHandler:function(e){this.iframeRawContent="data:text/html;charset=utf-8,".concat(encodeURIComponent(e.target.response))},xhrErrorHandler:function(){this.iframeRawContent="data:text/html;charset=utf-8,No uploaded!"}}},L=C,U=(o("9cf3"),Object(d["a"])(L,S,R,!1,null,null,null)),I=U.exports;function T(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function q(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?T(Object(o),!0).forEach((function(t){Object(i["a"])(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):T(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var M="AppSettings",A={name:"ReservationEmailHooks",components:{EmailHooksTable:f,DialogEmailUploader:E,DialogEditEmail:P,DialogEmailPreviewer:I},data:function(){return{hooks:[],showUploadDialog:!1,showDialog:!1,showPreviewer:!1,updateHook:{}}},computed:q({},Object(l["c"])(M,{loading:"IS_LOADING"})),mounted:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getReservationEmailHooks();case 2:this.hooks=e.sent;case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),methods:q({},Object(l["b"])(M,{getReservationEmailHooks:"GET_RESERVATION_EMAIL_HOOKS",updateReservationEmailHooks:"UPDATE_RESERVATIOM_EMAIL_HOOKS"}),{uploadHandler:function(e){this.showUploadDialog=!0,this.updateHook=e},enableHandler:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var o,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o="1"===t.isEnable?"0":"1",e.next=3,this.updateReservationEmailHooks(q({},t,{isEnable:o}));case 3:r=e.sent,r&&(t.isEnable=o);case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),editHandler:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.showDialog=!0,this.updateHook=t;case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),updateHookHandler:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var o,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:o=this.updateReservationEmailHooks(t),o&&(r=this.hooks.indexOf(this.updateHook),this.$set(this.hooks,r,t),this.showDialog=!1);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),previewHandler:function(e){this.showPreviewer=!0,this.updateHook=e}})},F=A,N=Object(d["a"])(F,r,n,!1,null,null,null);t["default"]=N.exports},"4a48":function(e,t,o){},"7dc7":function(e,t,o){"use strict";var r=o("4a48"),n=o.n(r);n.a},"8d9d":function(e,t,o){},"9cf3":function(e,t,o){"use strict";var r=o("8d9d"),n=o.n(r);n.a},e94b:function(e,t,o){"use strict";var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-form-item",{attrs:{label:e.label,prop:e.name}},[o("el-input",{attrs:{type:"text",name:e.name,placeholder:e.placeholder,maxlength:e.maxlength,disabled:e.disabled},model:{value:e.observeValue,callback:function(t){e.observeValue=t},expression:"observeValue"}}),e._v(" "),o("span",{staticClass:"notice-grey"},[e._v(e._s(e.messageMaxlength))])],1)},n=[],a=(o("c5f6"),{name:"TextInput",props:{value:{type:[String,Number],required:!0},name:{type:String,required:!0},label:{type:String,required:!0},placeholder:{type:String,required:!0},message:{type:String,default:function(){return""}},maxlength:{type:[Number,String],default:""},disabled:{type:Boolean,default:!1}},computed:{observeValue:{get:function(){return this.value},set:function(e){this.$emit("input",e)}},messageMaxlength:function(){return this.maxlength>0?"".concat(this.message?this.message+", ":"","字數限制：").concat(this.observeValue.length,"/").concat(this.maxlength):this.message}}}),i=a,l=o("2877"),s=Object(l["a"])(i,r,n,!1,null,null,null);t["a"]=s.exports}}]);